"use strict";(self.webpackChunkapp_src=self.webpackChunkapp_src||[]).push([[7809],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=p(n),c=o,m=h["".concat(l,".").concat(c)]||h[c]||u[c]||i;return n?a.createElement(m,r(r({ref:t},d),{},{components:n})):a.createElement(m,r({ref:t},d))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},476:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const i={slug:"using-ssh-agent-with-visual-studio-code-on-windows-10",title:"Using ssh-agent with Visual Studio Code on Windows 10",authors:["lejencodes"],tags:["ssh-agent","ssh","ssh-key","vscode","windows"]},r=void 0,s={permalink:"/blog/using-ssh-agent-with-visual-studio-code-on-windows-10",source:"@site/blog/2022-04-10-using-ssh-agent-with-visual-studio-code-on-windows-10.md",title:"Using ssh-agent with Visual Studio Code on Windows 10",description:"Enable the ssh-agent service",date:"2022-04-10T00:00:00.000Z",formattedDate:"April 10, 2022",tags:[{label:"ssh-agent",permalink:"/blog/tags/ssh-agent"},{label:"ssh",permalink:"/blog/tags/ssh"},{label:"ssh-key",permalink:"/blog/tags/ssh-key"},{label:"vscode",permalink:"/blog/tags/vscode"},{label:"windows",permalink:"/blog/tags/windows"}],readingTime:7.37,hasTruncateMarker:!1,authors:[{name:"Lejen",title:"Just a person",url:"https://lejencodes.com",imageURL:"https://github.com/lejencodes.png",key:"lejencodes"}],frontMatter:{slug:"using-ssh-agent-with-visual-studio-code-on-windows-10",title:"Using ssh-agent with Visual Studio Code on Windows 10",authors:["lejencodes"],tags:["ssh-agent","ssh","ssh-key","vscode","windows"]},prevItem:{title:"Python Refactoring",permalink:"/blog/python-refactoring"},nextItem:{title:"Make another branch as master",permalink:"/blog/make-another-branch-as-master"}},l={authorsImageUrls:[void 0]},p=[{value:"Enable the ssh-agent service",id:"enable-the-ssh-agent-service",level:3},{value:"Adding ssh keys",id:"adding-ssh-keys",level:3},{value:"Add a ssh key",id:"add-a-ssh-key",level:3},{value:"Step 0. Install Required Software",id:"step-0-install-required-software",level:2},{value:"Step 1. Setup Private Keys",id:"step-1-setup-private-keys",level:2},{value:"Step 2. Set up SSH Agent",id:"step-2-set-up-ssh-agent",level:2},{value:"Step 3. Add SSH Server Fingerprints",id:"step-3-add-ssh-server-fingerprints",level:2},{value:"Step 4. Configure Environment Variables",id:"step-4-configure-environment-variables",level:2}],d={toc:p};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"enable-the-ssh-agent-service"},"Enable the ssh-agent service"),(0,o.kt)("p",null,"To enable SSH Agent automatically on Windows, start PowerShell as an Administrator and run the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# Make sure you're running as an Administrator\nSet-Service ssh-agent -StartupType Automatic\nStart-Service ssh-agent\nGet-Service ssh-agent\n")),(0,o.kt)("h3",{id:"adding-ssh-keys"},"Adding ssh keys"),(0,o.kt)("p",null,"Run these commands in a terminal window within Visual Studio Code."),(0,o.kt)("p",null,"Show keys managed by the ssh-agent"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ssh-add -l\n")),(0,o.kt)("h3",{id:"add-a-ssh-key"},"Add a ssh key"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ssh-add\n")),(0,o.kt)("p",null,"For git, add a system environment variable or use a temporary setting in a PowerShell terminal of VSCode."),(0,o.kt)("p",null,'$env:GIT_SSH="C:\\Windows\\System32\\OpenSSH\\ssh.exe"'),(0,o.kt)("p",null,"If you add the line ",(0,o.kt)("inlineCode",{parentName:"p"},'$env:GIT_SSH="C:\\Windows\\System32\\OpenSSH\\ssh.exe"')," to your Powershell profile the environment variable will always be used."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.cgranade.com/blog/2016/06/06/ssh-keys-in-vscode.html"},"https://www.cgranade.com/blog/2016/06/06/ssh-keys-in-vscode.html")),(0,o.kt)("h1",{id:"using-ssh-keys-in-visual-studio-code-on-windows"},"Using SSH Keys in Visual Studio Code on Windows"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://code.visualstudio.com/"},"Visual Studio Code"),"\xa0is Microsoft\u2019s\xa0",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Microsoft/vscode/blob/master/LICENSE.txt"},"open-source"),"\xa0code editor for Windows, OS X and Linux. Nicely, VS Code has built-in support for Git and support for Python through\xa0",(0,o.kt)("a",{parentName:"p",href:"https://marketplace.visualstudio.com/items?itemName=donjayamanne.python"},"an extension"),", making it a useful for scientific development. Using VS Code on Windows is somewhat frustrated, however, if you want to work with a Git repository that was cloned using SSH. Thankfully, I found a workable solution using PuTTY and Git for Windows, such that VS Code transparently works with password-protected SSH keys. Below, I detailed how I got it working in as complete a detail as reasonable, but you may have already done some or even many of these steps. If so, the procedure is actually fairly simple, and consists of pointing Git (and hence VS Code) to use PuTTY and Pageant instead of the SSH version that ships with Git for Windows."),(0,o.kt)("p",null,"First, though, a disclaimer. These steps worked on my Windows 10 installation, but may not work on yours. If you find that this is the case, let me know, and I\u2019ll try and update accordingly."),(0,o.kt)("h2",{id:"step-0-install-required-software"},"Step 0. Install Required Software"),(0,o.kt)("p",null,"Before we get into things, we\u2019ll need a bit of software. In particular, we\u2019ll need:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://www.chiark.greenend.org.uk/~sgtatham/putty/"},"PuTTY"),"\xa0as a native-Windows SSH client and agent,"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://git-scm.com/download/win"},"Git for Windows"),"\xa0to use Git from PowerShell and VS Code, and"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/PowerShell/Win32-OpenSSH"},"OpenSSH for Windows"),"\xa0to generate SSH keys in the first place.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"WARNING")),": Do\xa0",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"not")),"\xa0install PuTTY from its official homepage, as this will download PuTTY over an insecure connection. This guide will cover how to download PuTTY securely."),(0,o.kt)("p",null,"For much of this, we can use the\xa0",(0,o.kt)("a",{parentName:"p",href:"https://chocolatey.org/"},"Chocolatey package manager"),"\xa0for Windows to save some grief, so let\u2019s start by installing that. If you already have Chocolatey, please skip this step. (If you aren\u2019t sure, try running\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"choco"),"\xa0from PowerShell.) Run PowerShell as administrator, then run the following command to download and install Chocolatey:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS> Set-ExecutionPolicy -Scope Process RemoteSigned\nPS> iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex\n")),(0,o.kt)("p",null,"Once this is done, close and reopen PowerShell (again as administrator). This will make\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"choco"),"\xa0available as a command. Now we can use it to install Git and OpenSSH (as above, we will\xa0",(0,o.kt)("em",{parentName:"p"},"not"),"\xa0install PuTTY using Chocolatey, as it will download PuTTY from its official homepage using an insecure connection). Run the following PowerShell commands to install Git and OpenSSH:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS> choco install git\nPS> choco install win32-openssh\n")),(0,o.kt)("p",null,"We\u2019ll finish up by downloading the version of PuTTY that ships with\xa0",(0,o.kt)("a",{parentName:"p",href:"https://winscp.net/"},"WinSCP"),", since that version is delivered via HTTPS and not insecure HTTP. In particular, use\xa0",(0,o.kt)("a",{parentName:"p",href:"https://winscp.net/download/putty-0.67-installer.exe"},"this link"),"\xa0to download PuTTY, then run the installer once you\u2019ve downloaded it."),(0,o.kt)("h2",{id:"step-1-setup-private-keys"},"Step 1. Setup Private Keys"),(0,o.kt)("p",null,"Once everything is installed, we now need to make sure that you have an SSH private key and that this key is registered with your Git hosting service (for instance, GitHub or Bitbucket). If you already have keys and have registered them with your hosting provider, please skip on ahead."),(0,o.kt)("p",null,"In any case, to generate keys, we\u2019ll again use PowerShell:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ssh-keygen\n")),(0,o.kt)("p",null,"Simply follow the prompts to make yourself a new public/private key pair, making sure to choose a long (~40 character) passphrase. This passphrase provides much of the entropy for your key, such that it should be much longer than a typical password.\xa0",(0,o.kt)("strong",{parentName:"p"},"Never"),"\xa0type your passphrase into a remote password prompt\u2014 the passphrase is used to unlock your key locally on your machine, and should\xa0",(0,o.kt)("strong",{parentName:"p"},"never"),"\xa0be sent over the network. If a website asks you for your SSH passphrase, you are probably being scammed."),(0,o.kt)("p",null,"By default, the new keys will be located in\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"C:\\Users\\<username>\\.ssh\\id_rsa"),"\xa0and\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"C:\\Users\\<username>\\.ssh\\id_rsa.pub"),". As the names suggest, the first of these is the\xa0",(0,o.kt)("em",{parentName:"p"},"private"),"\xa0key and should not be shared with anyone. The other is the public key, and serves to identify yourself to others. Follow the instructions for\xa0",(0,o.kt)("a",{parentName:"p",href:"https://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/"},"GitHub"),"\xa0or\xa0",(0,o.kt)("a",{parentName:"p",href:"https://confluence.atlassian.com/bitbucket/add-an-ssh-key-to-an-account-302811853.html"},"Bitbucket"),"\xa0(for Bitbucket, make sure to follow the Linux and OS X instructions, even from Windows) to upload your\xa0",(0,o.kt)("em",{parentName:"p"},"public"),"\xa0key to your hosting provider."),(0,o.kt)("h2",{id:"step-2-set-up-ssh-agent"},"Step 2. Set up SSH Agent"),(0,o.kt)("p",null,"Next, we\u2019ll make sure that your private key is setup in an SSH agent. This will securely remember your passphrase within a given session, so that you don\u2019t have to type it in every time you use it. In particular, we\u2019ll configure Pageant, since this is installed with PuTTY, and works well with a variety of command-line and GUI tools for Windows\u2014 most notably, with VS Code."),(0,o.kt)("p",null,"Pageant must be run at startup in order to be useful, so we\u2019ll begin by adding it to the startup folder now. In Windows Explorer (Windows 8.1 and earlier) or in File Explorer (Windows 10 and later), go to the folder\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"C:\\Users\\<username>\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup"),". Right-click inside this folder and select\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"New \u2192 Shortcut"),". From there, browse to\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"C:\\Program Files (x86)\\PuTTY"),"\xa0and select\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"pageant.exe"),"."),(0,o.kt)("p",null,"Next, we need to import your new key into PuTTY/Pageant."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Run PuTTYgen from the Start Menu and select\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"File \u2192 Load Key..."),"."),(0,o.kt)("li",{parentName:"ol"},"From there, navigate to\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"C:\\Users\\<username>\\.ssh\\"),"\xa0and select\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"id_rsa"),"\xa0(the private key). You may have to drop down the file types selector in the dialog box to see this, as PuTTYgen defaults to filtering out everything but files ending in\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"*.ppk"),". Once selected, you\u2019ll be prompted by PuTTY to unlock your key by typing in your passphrase. Do so, and PuTTYgen will show the corresponding public key."),(0,o.kt)("li",{parentName:"ol"},"Select\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"File \u2192 Save private key"),"\xa0to export your private key in PuTTY, rather than OpenSSH, format. I suggest saving it as\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"id_rsa.ppk"),"\xa0in the same folder as\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"id_rsa"),", but this is up to you. Just be sure that to save it in a folder that only you can read, and that is not synchronized using Dropbox, OneDrive, Google Drive or similar.")),(0,o.kt)("p",null,"Finally, run Pageant from the Start Menu (in the future, this will be handled automatically by the shortcut we created above). This will add a new icon to your system tray. It may be hidden by the arrow; if so, click the arrow to make all fo the system tray icons visible. Right-click on Pageant and select\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"Add Key"),". Browse to where you saved\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"id_rsa.ppk"),"\xa0and select it. You\u2019ll be prompted to unlock your key. Upon doing so, your unlocked key will then be made available in Pageant until you log out or quit Pageant."),(0,o.kt)("h2",{id:"step-3-add-ssh-server-fingerprints"},"Step 3. Add SSH Server Fingerprints"),(0,o.kt)("p",null,"Despite the name, this is a short step. Whenever you log into an SSH server, PuTTY will check that the server\u2019s\xa0",(0,o.kt)("em",{parentName:"p"},"fingerprint"),"\xa0is correct. This is a short cryptographic string identifying that server, such that checking the fingerprint helps against man-in-the-middle attacks. If you haven\u2019t logged into a server with PuTTY before, however, it has no idea how to check the fingerprint, and will fail to login. Since VS Code ignores these errors, Git support will silently fail unless you first attempt to log into the SSH server offered by your Git host. To do so, we\u2019ll use PowerShell one last time. Run one of the following commands below, depending on which hosting provider you use."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS > & 'C:\\Program Files (x86)\\PuTTY\\plink.exe' git@github.com\nPS > & 'C:\\Program Files (x86)\\PuTTY\\plink.exe' git@bitbucket.org\n")),(0,o.kt)("p",null,"In either case, you\u2019ll be prompted to add the server\u2019s fingerprint to the registry. If you are confident that your traffic is not being intercepted, select\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"y"),"\xa0at this prompt. Neither GitHub nor Bitbucket actually allows logins via SSH, so you\u2019ll get an error, but this is OK: you\u2019ve gotten far enough to see the server\u2019s fingerprint, and that\u2019s all we needed. To check, you can run the commands above again, and note that you are no longer prompted to add the fingerprint, but instead fail immediately."),(0,o.kt)("h2",{id:"step-4-configure-environment-variables"},"Step 4. Configure Environment Variables"),(0,o.kt)("p",null,"We\u2019re almost done. All that\u2019s left is to point Git for Windows at PuTTY and Pageant, rather than its own built-in SSH client. Since VS Code uses Git for Windows, this will ensure that VS Code does what we want."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Right-click on\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"My Computer"),"\xa0or\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"This PC"),"\xa0in Windows/File Explorer, and select\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"Properties"),"."),(0,o.kt)("li",{parentName:"ol"},"From there, click\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"Advanced system settings"),"\xa0in the sidebar to the left. On the\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"Advanced"),"\xa0tab, press the\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"Environment Variables..."),"\xa0button at the bottom."),(0,o.kt)("li",{parentName:"ol"},"Finally, click\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"New..."),"\xa0on the user variables pane (top), and add a new variable named\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"GIT_SSH"),"\xa0with value\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"C:\\Program Files (x86)\\PuTTY\\plink.exe"),"."),(0,o.kt)("li",{parentName:"ol"},"You may want to use\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"Browse File..."),"\xa0in this dialog box to make sure you get the path correct."),(0,o.kt)("li",{parentName:"ol"},"Once done, press\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"OK"),"\xa0to add the variable,\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"OK"),"\xa0again to close the Environment Variables dialog, then\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"OK"),"\xa0a third time to close System Properties."),(0,o.kt)("li",{parentName:"ol"},"Finally, close the System window.")))}u.isMDXComponent=!0}}]);